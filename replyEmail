kind: AdaptiveDialog
inputs:
  - kind: ManualTaskInput
    propertyName: messageID
    value: id of message

  - kind: ManualTaskInput
    propertyName: emailFound
    value: email found from topic

  - kind: ManualTaskInput
    propertyName: toEmails
    value: emails to respond to

modelDescription: find email and ask the user if they would like to reply
beginDialog:
  kind: OnRedirect
  id: main
  actions:
    - kind: InvokeAIBuilderModelAction
      id: iIkisT
      input:
        binding:
          inputEmail: =Topic.emailFound

      output:
        binding:
          predictionOutput: Topic.outputRecord

      aIModelId: 3f453886-7077-4bd3-8dc7-ca002a9a965a

    - kind: SetVariable
      id: qMJdEa
      variable: Topic.outputMessageText
      value: =Topic.outputRecord.text

    - kind: SendActivity
      id: RWyQXg
      activity: |-
        Feel free to copy and paste this sample reply generated for you! Make sure to review and edit where needed.
        {Topic.outputMessageText}

    - kind: AdaptiveCardPrompt
      id: kQDZKW
      card: |-
        {
          "type": "AdaptiveCard",
          "$schema": "https://adaptivecards.io/schemas/adaptive-card.json",
          "version": "1.5",
          "body": [
            {
              "type": "TextBlock",
              "text": "Reply Email",
              "wrap": true,
              "spacing": "None",
              "size": "Medium"
            },
            {
              "type": "TextBlock",
              "wrap": true,
              "text": "Please review all information carefully before sending",
              "id": "infoText"
            },
            {
              "type": "Input.Text",
              "label": "Body:",
              "isMultiline": true,
              "id": "bodyText",
              "height": "stretch",
              "placeholder": "Hi,\n\nPlease enter your email here.\n\nThanks!"
            }
          ],
          "actions": [
            {
              "type": "Action.Submit",
              "title": "Submit",
              "id": "submitButton",
              "iconUrl": "icon:Send"
            }
          ],
          "minHeight": "450px"
        }
      output:
        binding:
          actionSubmitId: Topic.actionSubmitId
          bodyText: Topic.bodyText

      outputType:
        properties:
          actionSubmitId: String
          bodyText: String

    - kind: InvokeAIBuilderModelAction
      id: 9xIFFO
      input:
        binding:
          Markdown_20Text: =Topic.bodyText

      output:
        binding:
          predictionOutput: Topic.finalHtmlEmail

      aIModelId: e35b32a0-9364-45bc-bbd1-411b153a90f8

    - kind: Question
      id: question_KXFnN8
      interruptionPolicy:
        allowInterruption: true

      variable: init:Topic.sendEmailChoice
      prompt: |-
        **Your email:**

        **To:** {Topic.toEmails}

        **Body:**
        {Topic.finalHtmlEmail.text}
      entity:
        kind: EmbeddedEntity
        definition:
          kind: ClosedListEntity
          items:
            - id: Send
              displayName: Send

            - id: Cancel
              displayName: Cancel

    - kind: ConditionGroup
      id: conditionGroup_l1lh2Z
      conditions:
        - id: conditionItem_35NDSz
          condition: =Topic.sendEmailChoice = 'cr689_customerCareAssistant.topic.replyemail.main.question_KXFnN8'.Send

        - id: conditionItem_X66qz4
          condition: =Topic.sendEmailChoice = 'cr689_customerCareAssistant.topic.replyemail.main.question_KXFnN8'.Cancel
          actions:
            - kind: SendActivity
              id: sendActivity_j96m57
              activity: |-
                Cancelling reply email.
                Nothing will be sent.

            - kind: EndDialog
              id: IB5Ds7

      elseActions:
        - kind: EndDialog
          id: 4X1dfa

    - kind: BeginDialog
      id: FpFoU4
      input:
        binding:
          Body: =Topic.finalHtmlEmail.text
          messageId: =Topic.messageID
          To: =Topic.toEmails

      dialog: cr689_customerCareAssistant.action.Office365Outlook-ReplytoemailV3

inputType:
  properties:
    emailFound:
      displayName: emailFound
      type: String

    messageID:
      displayName: messageID
      type: String

    toEmails:
      displayName: toEmails
      type: String

outputType: {}
